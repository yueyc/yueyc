##1.2.1 UTN网络简介-客户响应专业(UTN网络简介)
###1.2.1 UTN网络的发展
UTN是在SDH和MSTP的基础上发展而来。（结合了数据通信的特点（弹性带宽、三层功能、数据业务处理能力）和MSTP的优点（多业务承载和可靠性和可维护性）形成了分组传送技术。）
分组传送技术——是一种以分组为内核，主要面向电信级分组业务传送，兼容TDM,ATM和Ethernet等综合业务的融合传送技术。

###1.2.2 UTN网络结构
UTN网络定位是一张本地传送网，要求做到多业务承载能力，分为核心层（地市的核心机房与其他核心设备对接，2GBSC 3GRNC、4G承载A网和B网，电信设备等等、集团设备对接的集客业务设备。 ）、汇聚层（县级核心机房，汇聚本区域的业务，传送到核心层相关专业）和接入层（基站或者综合业务接入点，接入分支点或者基站业务）。

###1.2.3 UTN配置
数据特性配置和传输特性配置
**数据配置主要分为三个部分**：
* IGP配置，实现设备之间的互访，lookback地址的互访。
* MPLS配置，建立端到端的隧道。
* 业务配置，根据不同业务需要建立三层VPN业务和两层VPN业务。  
**传输特性的配置主要分为两个部分**
* 同步：时钟同步和时间同步。
* 保护配置，根据不同业务采用不同的保护方式。
![UTN数据配置的三个方面](../image/1.png)

###1.2.4 UTN网络保护
**MCPE(智能专线终端设备)**
**LACP(Link Aggregation Control Protocal 链路汇聚控制协议)**  
**UTN网络保护**：
![UTN网络保护](../image/2.png)

##1.2.2 UTN网络保护技术—HSB-客户响应专业

###1.2.2.1 HSB的保护的定义
**HSB**:Hot-Standby热备份保护。  
当主用隧道中链路或者节点发生故障的时候，就切换到备用LSP，用来实现对主用LSP进行保护，**同时要结合BFD加快故障检测（这句话加在这里很突兀，不太好理解）**（label switching path，**本身就是隧道** 通过**RSVP-TE**信令来实现。）
###1.2.2.2 HSB的保护的原理
发送端两条选择一条发数据，收的时候两端都可以收，同时，BFD加快故障检测。
###1.2.2.3 主备用隧道的建立过程

**通俗版本****TE（traffic Engineering） 流量工程实际上就是一系列工具和方法实现资源优化，提供最好的网络服务。**

**专业版本****TE（traffic Engineering**  
传统路由根据最短路径转发流量，这导致即使网络拥塞，也不会将流量切换到其他路径上，这导致网络服务质量的降低。流量工程提供了解决方法，通过流量过程，服务提供商可以精确地控制流量流经的路径，从而避免拥塞，使得网络负载均衡。  
流量过程关注的是整体性能的优化，其目标是方便的提供高效、可靠的网络服务，优化网络资源的使用，优化网络流量。

**流量工程分为两个层面：** 

 * 面向流量，如何提高网络的服务质量
 * 面向资源，实现网络资源主要是带宽资源的有效利用。 
  
**MPLS TE的实现**

* 信息发布，负责搜集网络信息（路由的泛洪），通过IS-IS、OSPF-TE实现。
* 路径计算：负责路径的计算，通过CSPF来实现。
* 信令协议：通过RSVP TE 或者CR-LDP协议建立LSP。
* 数据转发，实现MPLS标签转发。
* **前三个是控制面 第四个是转发面。**
![MPLS 流量工程的实现](../image/3.png)
###1.2.2.4 BFD故障检测技术
BFD（bi-forwarding detection 双向转发检测），为各种上层控制协议提供一种通用的低开销的快速故障检测服务。
就是在两个路由器之间周期性的发送检测信号，如果对面收不到，那说明链路出现故障，BFD邻居就撤销，BFD通知其支撑的应用模块断开连接，应用就可以进行LSP切换。

注：  

*  普通的MPLS网络建立LSP使用LDP(label Distribution Protocal)。
*  IPRAN网络中隧道建立使用的信令协议是RSVP-T(Resource reSerVation Protocol 资源预留协议)

##1.2.3 UTN网络保护技术—PW-客户响应专业
###1.2.3.1 PWE3出现的原因

**PWE3（pseudo-Wire Emulation Edge to Edge， 边缘到边缘的伪基线仿真）**  
**SONET(Synchronus Optional Network同步光纤网络)**  
**SDH(Synchronus Digital Hierarchy，一种数字传输技术)**
**PSN(Packet Switched Network，分组交换网)**  

众所周知，IP网络本身拓展性兼容性非常强，而传统的通信网络升级扩展和互通的灵活性相对比较差，并且新建网络的功用性也较差，不易于互通管理，因此传统的通信网面临着升级，在这个过程中，各自建立重复的网络还是充分利用现有或者公共的资源达到升级网络和扩展应用的目的。PWE3正是为解决传统网络与现有分组网络（PSN）结合而提出的方法。

###1.2.3.2 PWE3的原理
PWE3是在分组交换网（**PSN,如IP/MPLS**）上提供隧道（**Tunnel**，**一种网络协议来承载另外一种协议**），以便仿真一些业务（FR,ATM,Ethernet，TDM，SONET/SDH）的二层VPN协议，通过这个协议可以将传统的网络和分组交换网络互连起来，从而实现资源的功用和网络的拓展。

###1.2.3.3 PWE3的工作过程
PWE3是一种端到端的二层业务承载技术，属于点到点方式的L2VPN, 在PSN的两台PE中，其以LDP(label distribution Protocal，标签分发协议)/RSVP(Resource ReSerVation Protocol，资源预留协议)信令，通过隧道（MPLS,GRE,L2TPv3模拟CE端的各种业务，如各种二层数据报文，比特流，是CE端的二层数据在PSN网络中透明传输。（**就是对原有的数据的加上一层标签，然后通过转发协议发送给对端**）


**相关名词**  
 
* AC(Attachment Circuit 接入链路)：CE到PE之间的连接链路或者虚电路，AC上的所有用户报文一般都要求原封不动的转发到对面的site去，包括用户的二三层协议报文。
* PW(Pseudo Wire 虚链路，伪基线)所谓的伪基线就是VC(Virtual Circuit，虚电路)。虚电路是有方向的，PWE3的伪基线的建立是通过LDP或者RSVP来传递VC信息（标签分发协议，建立转发表），将VC信息和隧道管理形成一个伪基线。形成本地AC到对端AC的一条直接相连的通道，完成用户的二层数据透传。
![PWE3的工作过程](../image/4.png)

###1.2.3.4 PW业务保护技术
* 通过建立两条伪基线方式实现在节点失效的情况下，业务不中断的目的。  

*保护模式分为主备模式（不发生主备切换）和独立模式（发生主备切换）

##1.2.4 UTN网络保护技术—VRRP-客户响应专业

###1.2.4.1 VRRP的出现的原因
通常，同一个网段内的所有主机都设置一条相同的，以网关为下一条地址的缺省路由。主机发往其他网段的报文将通过缺省路由发送网络，再由网关进行转发，从而实现主机与外部网络的通。当这个网关发生故障的时候，本网段内所有以网关为缺省路由的主机将无法与外部网络通信。

缺省路由为用户的配置操作提供了方便，但是缺省网关设备提出了很高的稳定性要求。增加出口网关是提高系统可靠性的常见方法，但是如何在多个出口之间进行选路就是关键问题。
**VRRP(Virtual Router Redundancy Protocal 虚拟路由器冗余协议)**将可以承担网关功能的一组路由器加入到备份组中，形成一台虚拟路由器。由VRRP的选取机制决定哪台路由器承担转发任务，局域网内的主机只需要将虚拟路由器配置为缺省网关。

**VRRP**是一种容错协议，简化了主机配置，借助VRRP能在某台路由器出现故障的时候依然可以提供可靠的缺省路由，有效避免单一链路发生故障后的网络中断的问题，从而午休动态修改路由协议，路由发生配置协议等配置信息。
###1.2.4.2 VRRP协议的版本
VRRP协议版本实现有VPPRv2版本和VPPRv3版本，VPPRv2支持IPv4，VRRPv3支持IPv6，实现上相同，只是应用的网络环境不同。
###1.2.4.3 VRRP备份组
VRRP（Virtual Router Redundancy Protocal 虚拟路由器备份协议）将局域网的一组路由器划分在一起，成为一个备份组，备份组由一个Mater路由器和多个Backup路由器构成，功能上相当于一台虚拟路由器。  

* VRRP备份组的特点
  * 虚拟路由器具有IP组织，成为虚拟IP地址，局域网内的主机只需要这个虚拟路由器的IP地址，并将其设置为缺省路由的下一条地址。
  * 网络内的主机通过这个虚拟路由器与外部网络进行通信。
  * 备份组内的路由器根据优先级，选举区Mster路由器，承担网关功能，当Master发生故障后，取代Master履行网关职责，与外部通信。
 
###1.2.4.4 VRRP的IP地址的来源。
* 虚拟路由器IP地址可以使备份组所在网段中没有被分配的IP地址。  
* 也可以和备份组内的某个路由器的接口IP地址相同的某个地址。  
* 自然而然，如果当前VRRP路由器IP和当前物理路由器接口一致，他就是主路由器即IP地址拥有者。  

###1.2.4.5 VRRP的工作过程
* 路由器开启VRRP功能后，会根据优先级确定自己在备份组中的角色，优先级高的成为Master，优先级低的Backup路由器，Master路由器定期发送VRRP通告报文，通知备份组内的其他路由器工作正常，Backup路由器启动定时器等待Master消息的到来。
*  在抢占模式下，当Backup路由器收到VRRP报文后，会将自己的优先级和报文中的优先级进行比较，如果自己的优先级高，则会成为Master路由器。
*  在非抢占模式下，只要Master没有出现故障，即使自己的优先级比较高，也不会成为Master路由。
*  如果backup路由器的定时器超时后没有收到Master报文，则认为Master无法正常工作，此时Backup路由器会重新选举成为Master路由器。
###1.2.4.6 VRRP 如何成为备份路由器
 人工配置虚拟的IP和虚拟MAC地址。