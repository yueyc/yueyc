3/9/2021 10:41:39 AM  
##11.2 虚拟化技术介绍
* 了解虚拟化技术的背景和基础原理
* 熟悉计算虚拟化技术
* 熟悉存储虚拟化技术
* 熟悉网络虚拟化技术
* 熟悉应用虚拟化技术
###11.2.1 虚拟化技术定义
虚拟化是一种资源管理技术，是将计算机的各种实体资源，如服务器，网络，内存的以及存储等，予以抽象、转换后呈现出来，打破实体结构件的不可切割的障碍，是用户可以比原本的组态更好的方式应用这些资源。
* 计算虚拟化
* 存储虚拟化
* 网络虚拟化
* 应用虚拟化
###11.2.2 虚拟化技术过程
* IT资源独立 + 操作系统与硬件紧耦合 ————>资源抽象成公共资源池，操作系统与硬件解耦，从资源池中分配资源。
###11.2.3 虚拟化技术优势
|性能|虚拟化前|虚拟化|
|:--|:--:|
|资源利用率|每台主机一个操作系统，系统的资源利用率低|一台主机对应多个操作性系统，按需分配使用，系统资源利用率高
|独立性|软硬件紧密结合，硬件成本高昂且不够灵活|操作系统和硬件不相互以来，虚拟机独立于硬件，能在任何硬件上运行|
|程序运行效率|同一台主机上同时运行多个程序容易产生冲突，运行效率比较低|管理操作系统和应用程序被封装成为单一个体，不同个体间不冲突，同一台机器上运行着同一个程序，效率高。
|安全稳定性|稳定性较差|强大的安全和故障隔离|

###11.2.4 虚拟化与云计算的关系
* 虚拟化是云计算的关键技术之一，实现计算必须使用虚拟化技术，实现资源的动态弹性分配，任何一个云计算管理平台，都是构建咋虚拟化管理平台的基础上的。
* 虚拟化资源需要管理员进行管理和分配，云计算是用户自主管理和使用。
* 云计算完全解除了软件和硬件耦合度，所有基础设施资源均虚拟化后通过资源池进行配额衡量，与硬件无关，虚拟化虽然实现了资源池话，但是资源的分配与硬件一定程度上关联。
###11.2.5 虚拟化层次结构
* Guest os:虚拟机操作系统
* Guest Machine:虚拟出来的虚拟机
* Hypervisor:虚拟化软件层/虚拟机监视器(VirtualMachine Monitor，VMM)
* Host Os:运行在物理机之上的OS
* Host Machine:物理机

![IP VPN分类](../image/1.png)
###11.2.6 虚拟机架构
* 寄居虚拟化架构
 * 寄居虚拟化架构在宿主操作系统上安装和运行虚拟化程序，依赖于**宿主操作系统对设备的支持和物理资源的管理**。
 * 类似 **Vmware Workstation** 的程序
 * 
 ![寄居虚拟化架构](../image/2.png)

* 裸金属虚拟化架构
 * 裸金属虚拟化架构指直接在硬件上面安装虚拟化软件，再在其上安装操作系统和应用，依赖虚拟层内核和服务器控制台进行管理. 
 
 ![寄居虚拟化架构](../image/3.png)

* 操作系统虚拟化架构
 * 操作系统虚拟化架构在操作系统层面增加**虚拟服务器**功能。操作系统虚拟化架构把单个的操作系统划分为多个容器，使用容器管理器来进行管理。 
 * **宿主操作系统**负责在多个虚拟服务器（**即容器**）之间分配硬件资源，并且让这些服务器彼此独立。
 
  ![寄居虚拟化架构](../image/4.png)
* virtual Machine monitor 虚拟机监视器 = 虚拟化层
#### 虚拟机架构的比较
  ![虚拟化架构的比较](../image/5.png)
###11.2.7 常见虚拟化软件
* VMvare：业界领袖，从服务器虚拟化产品起家，现有完整产品线，提供丰富的虚拟化和云计算解决方案。
* Linux KVM(Kernal-based Virtual Machine):是基于Linux x86硬件平台的开源全虚拟化解决方案，也是主流的Linux虚拟化解决方案。
 * Linux内核的KVM模块主要负责虚拟机的创建，虚拟内存的分配，VCPU寄存器的读写和VCPU运行。
 * 提供硬件仿真的QEMU，用于模拟虚拟机的用户空间组件，提供I/O设备模型和访问外设的途径。
 * KVM最大的优势是开源，受到开源云计算平台的广泛支持。
 
  ![虚拟化架构的比较](../image/6.png)

* Hyper-V是微软提出的企业级虚拟化解决方案。
 * 微内核架构
 * 只有“硬件-Hyper-V-虚拟机”三层，本身非常小巧，代码简单，不包含第三方驱动。
 * Hyper-V的优势是与Windows服务器集成，在开发测试与培训领域应用较多。
 
* 比较
  ![虚拟化架构的比较](../image/7.png)
###11.2.8 计算虚拟化
####分类：
* CPU虚拟化
  * 物理CPU由多个VM共享，需要对VM中敏感指令进行截取并模拟执行。 
* 内存虚拟化
 * 物理内存由多个VM共享，拥有各自独立的内存空间。 
* IO设备虚拟化
 * 把真实IO包装起来给多个VM共享，响应每个虚拟机的IO请求。
#### CPU虚拟化
X86处理器通过Ring级别进行访问控制的，由高到第共分4层：RING0,RING1,RING2,RING3。

* R0层具有最高权限，OS工作在R0层，可以访问所有层数据。
* 应用程序工作在R3层，只能访问R3层数据。
* 其他驱动程序位于R1R2层，能访问本层以及更地层数据。

注：虚拟化软件VMM运行在R0层，进行硬件资源的分配处理。

#### CPU虚拟化实现的分类
* 全虚拟化
 * 虚拟机的所有指令先发到虚拟化层，由虚拟化层进行翻译再给地层硬件。
 * 不需要修改客户机OS，支持OS种类多，
 * 兼容性好，但是会给处理器带来额外开销。 
* 半虚拟化
 * 修改客户机OS，将敏感指令的操作换为相应的函数，客户机OS调用这些函数将控制权交给VMM，VMM完成指令执行。
 * 性能高，兼容性差。
* 硬件辅助虚拟化
 * 借助硬件实现全虚拟化，敏感指令在受控模式下全部切换至VMM，上下文保存恢复由硬件来实现。
 * 主要有Intel的VT-X和AMD-V这两种技术。 
   ![虚拟化架构的比较](../image/8.png)
#### 内存虚拟化
客户机操作系统使用的是虚拟内存，因此需要建立映射关系。
* 应用内存地址：虚拟操作系统给应用程序使用的地质。
* 虚拟内存地址：Hypervisor虚拟后虚拟机看到的内存地址。
* 物理内存地址：硬件物理地址。
* 内存地址的映射关系：
 * 虚拟操作系统维护一套页表：虚拟内存地址---应用内存地址的映射
 * Hypervisor负责维护一套页表：虚拟内存地址---物理内存地址。
* 内存复用技术
 * 通过内存气泡，零页共享和内存交换技术
 * 虚拟机内存总量大于主机内存
 * 宿主机内8G = 虚拟机4G + 虚拟机4G + 虚拟机4G、
#### IO虚拟化
* 全虚拟化：通过VMM模拟IO
* 半虚拟化：通过前端和后端实现虚拟化
* IO直通：直接访问IO
###11.2.9 存储虚拟化
####存储虚拟化的原因
* 标准化接入
* 统一数据管理
* 空间资源整合
####存储虚拟化的定义
存储虚拟化（Storage Virtualization）就是对存储硬件资源进行抽象化表现。

虚拟化存储系统在原来的存储系统的基础上增加了一个虚拟化层，将多个存储单元抽象成为一个存储池，存储单元可以是异构的，可以是直接存储设备，也可以是网络存储设备。

* 好处：
 * 减少存储系统的开销
 * 实现存储系统的数据共享
 * 提高透明的高可靠性和可扩展性。
####存储虚拟化的实现
* 基于主机的虚拟化
* 基于存储设备的存储虚拟化
* 基于网络的存储虚拟化 

####基于主机的存储虚拟化
* 主要用途：是的服务器的存储空间可以跨过多个异构的磁阵列，常用在不同磁盘阵列之间做数据镜像保护。
* 实现方式：一般由操作系统下的逻辑卷管理软件组成。
* 优点：支持异构的存储系统
* 缺点：占用主机资源，存在兼容性问题，升级 维护复杂，数据迁移困难
####基于存储设备的虚拟化
* 在同一存储设备内部，进行数据保护和迁移
* 实现方式：在存储控制器上增加虚拟化功能，常见于高端存储设备。
* 优点：与主机无关，不占用主机资源；数据管理功能丰富。
* 缺点：只能对本厂商设备虚拟化，不同厂商的数据管理功能不能互操作；成本高
####基于网络的存储虚拟化
* 主要用途：异构存储系统整合与统一数据管理
* 实现方式，通过在存储域网（SAN）中增加虚拟化引擎实现。
   ![虚拟化架构的比较](../image/9.png)
###11.2.10 网络虚拟化
####实现方式
* 虚拟交换机vSwitch
* Open vSwitch

#### 虚拟分布式交换机特征
![虚拟化架构的比较](../image/10.png)

###11.2.11 应用虚拟化
###11.2.12 桌面虚拟化

###11.2.13 习题
* 15.( 难度：容易)虚拟化思想初次提出的年代及提出者？（)(D)
 * A.19世纪70年代，IBM
 * B.19世纪80年代，IBM
 * C.19世纪50年代，IBM
 * D.19世纪60年代，IBM
* 31.( 难度：容易)SD-WAN的目标是通过虚拟化技术、应用级的策略、边缘的CPE设备实现企业的灵活组网，它还采用了哪种网络技术?（）(A)
 * A.Overlay
 * B.Underlay
 * C.Switch
 * D.Router
* 753.( 难度：中等)（）依托互联网信息技术实现互联网与传统产业的联合(D)
 * A.云计算
 * B.物联网
 * C.虚拟化技术
 * D.互联网+
* 757.( 难度：中等)大型信息系统是以信息技术和（）为支撑的大系统(A)
 * A.通信技术
 * B.安全技术
 * C.数据处理技术
 * D.虚拟化技术

* 1478.( 难度：中等)KVM是（     ）虚拟化技术。(C) 
  * A.全虚拟化
  * B.半虚拟化
  * C.**硬件辅助的虚拟化**
  * D.平台虚拟化

* 1559.( 难度：中等)主流的服务器虚拟化技术不包括以下哪一项。(A)
 * A.virtualbox
 * B.KVM
 * C.Xen
 * D.Hyper-V
* 1581.( 难度：中等)联通医疗云配置虚拟化安全组件满足（）流量防护和租户安全。(B)
 * A.南北向
 * B.东西向
 * C.互联网
 * D.5G
 
* 10.( 难度：中等)以下有关桌面虚拟化说法正确的是哪几项？（）(ABC)
 * A.IT 管理员能快速更新和部署OS，减少管理难度。
 * B.桌面虚拟化是指将计算机的终端系统(也称作桌面)进行虚拟化，可以通过任何设备，在任何地点，任何时间通过网络访问属于我们个人的桌面系统。
 * C.桌面虚拟化技术实质上是将用户使用与系统管理进行了有效的分离。
 * D.桌面虚拟化可以提高资源利用，节约成本，但由于是网络访问，数据安全得不到保障。

* 27.( 难度：难)虚拟化技术特性包括哪些。（）(ABCD)
 * A.在单一服务器上同时运行多个虚拟机
 * B.在同一服务器上的虚拟机之间相互隔离
 * C.整个虚拟机都保存在文件中，而且可以通过移动和复制这些文件的方式来移动和备份该虚拟机
 * D.相对于硬件独立，无需修改即可在服务器上运行虚拟机

* 430.( 难度：中等)网络虚拟化作为云计算关键技术之一，可将网络的硬件资源、软件资源以及网络功能整合成一个基于软件的可管理的整体。沃云在网络方面可以提供的产品和服务包括(ABCD)
 * A.私有网络
 * B.网络接入
 * C.虚拟路由器
 * D.IPv6

* 550.( 难度：中等)以下关于云计算特点说法正确的有：(ABCD)
 * A.通用性
 * B.高可靠性
 * C.按需服务
 * D.虚拟化
* 1110.( 难度：中等)以下说法哪种是错误的？(C)
 * A.资源池化实现的是计算资源、存储资源的共享
 * B.云实现的一种开箱即用的服务模式
 * C.医院基础设施云化与医院基础设施虚拟化是一个概念
 * D.医院基础设施云化与传统的主机托管不同
* 1224.( 难度：中等)5G的主要技术有以下哪些（）。(ABCD)
 * A.NFV网络功能虚拟化技术
 * B.SDN软件定义网络技术
 * C.网络切片技术
 * D.MEC边缘云计算技术

* 1547.( 难度：中等)下列哪些是云计算安全设计需要考虑的方面？（多选）(ABCDE)
 * A.基础设备安全
 * B.管理安全
 * C.虚拟化安全
 * D.网络安全
 * E.数据安全