2/4/2021 6:53:13 PM 
##2.1.1 UTN以太网组网01-MCPE
###2.1.1.1 MCPE设备的功能
可管理的CPE设备，其功能和MSAP相似，一般放置在用户机房，一般与用户设备对接，另外一侧与UTN设备对接，将数据传送到UTN网络上，实现数据传输，提供综合网管功能，将不同厂家和不同型号的设备纳入到同一个网管中进行管理方便日常维护。
分为M1/M2/M3三种设备。
![PWE3的工作过程](../image/1.png)
##2.1.2 UTN以太网组网02-VPWS-客户响应专业（UTN以太网组网02）
###2.1.2.1 EVPN VPWS
EVPN VPWS（Virtual Private Wire Service 虚拟专线服务）是控制层面采用MP-BGP通告EVPN的路由信息，数据层面采用MPLS封装的二层VPN技术。用户网络的数据报文直接通过交叉连接下的AC和PW转发，无需查找二层MAC地址，为用户提供点到带你的二层服务。  

* **EVPN(Ethernet Virtual Private Network)**由RFC7432(BGP MPLS-Based Ethernet VPN) 定义，这是一个基于BGP和MPLS的L2VPN。
* **VPWS(Virtual Private Wire Services 虚拟专线服务)**是一个点对点的二层VPN解决方案。
* 可以支持的二层技术主要有：FR\ATM\以太网\以太网VLAN\HDLC\PPP\SONET\SDH链路仿真服务。
* 在两个PE路由器之间实现二层透明传输的两个端口必须是相同的类型。

###VPWS（虚拟专线服务）的工作方式
* 通过伪线PW,提供连接CE之间，与接入电路性质相同的点到点的联通性。
* 通过LDP协议在PE之间创建公共通道（LSP）.
* 建立用户点到点之间的对应关系。

###建立远程连接
EVPN VPWS远程连接通过穿越IP或MPLS骨干网络的PW连接两端的用户网络，为用户提供点对点的二层服务，要想通过VPWS的远程连接转发报文，需要完成下面的工作。
 
 * 建立公网隧道 ，公网隧道用来承载PE之间的一条或者多条PW.
 * 建立用来传送特定用户网络报文的PW,PW标签标识了表文所述的用户网络。
 * 建立用来连接CE和PE的AC,AC的报文匹配规则决定了CE收到的哪些报文属于一个特定的用户网络。
 * 将AC和PW关联，以便确定从AC接收到的报文向指定的PW转发，从PW接收到的报文向指定AC转发。
   
  完成上述配置之后，PE从AC（接入电路）接收到用户网络的报文后，根据AC关联到PW为报文封装PW标签，并通过公网隧道将报文转发给远端的PE,远端PE从公网隧道接收到报文后，根据PW标签判断归属的PW，并将还原后的原始报文转发给PW关联的AC.

###MPLS L2 VPN
**MPLS L2VP出现的原因**
 传统的异步网络（ATM）或者帧中继网络（FR,Frame Relay）的VPN应用非常广泛，其不足在于：
   
* 依赖于专用的网络，要提供ATM或者FR网络的VPN,必须建立全部范围的ATM或者FR网络，造成网络建设上的浪费。
* 部署复杂，一个站点的修改，需要对所有的接入此站点的边缘节点的配置。
*  MPLS L2VPN 提供基于MPLS网络的二层服务，使运营商可以在统一的MPLS网络上提供基于不同数据链路层的二层VPN,包括ATM,FR,VLAN，Ethernet PPP等。
简单来说，MPLS L2VPN就是在MPLS网络上透明传输二层数据，从用户角度来看，MPLS网络是一个二层交换网络，可以在不同节点建立二层连接。
  * 可扩展性强，不引入和管理用户路由，减轻了PE，甚至整个SP网络的负担，使服务提供商支持更多的VPN和接入更多的用户。
  * 可靠性和私网路由的安全性得到保证，由于不引入用户路由信息，不能获得和处理用户路由，保证了用户VPN路由的安全。
  * 支持多网络层协议，包括IP,IPX以及SNA.
 
##2.1.3UTN以太网组网03-智能专线-客户响应专业（UTN以太网组网03-智能专线）

###2.1.3.1 智能专线
智能（智能体现在其采用Overlay技术实现的）专线是一种承载集客专线业务的技术，通过借助MCPE设备，实现点到点、点到多点和多点到多点的互访需求。
###2.1.3.2 智能专线的原理
 * MPLS封装，采用MPLS标签区分接入的不同用户数据（区分不同的用户）。
 * GRE隧道，通过路由协议封装，将增加完MPLS标签的用户报文封装进GRE隧道，GRE头部为对端的MCPE设备的lookback地址。（要找到这个设备就行了）。
 * L3VPN：在UTN网络上创建VRF（虚拟路由转发），UTN网络负责寻址MCPE设备（这个地方也要创建MPLS，进行转发）。
 * L2业务，将用户数据（包括MAC层和IP层）完全封装到隧道内，全程不参与任何用户数据的处理。
 
![PWE3的工作过程](../image/2.png)
###2.1.3.3 域内UTN业务配置方式
 * 在UTN网络新建2个VPN,分别承载业务和管理通道
 * UTN负责寻址MCPE设备，MCPE负责区分不同用户、限速。
###2.1.3.4 跨域UTN业务配置方式
 * 通过承载网A网实现UTN网络互通
 * UTN与承载A网采用OptionA方式互通
 * 采用静态路由或者EBGP方式通告汇总路由。
