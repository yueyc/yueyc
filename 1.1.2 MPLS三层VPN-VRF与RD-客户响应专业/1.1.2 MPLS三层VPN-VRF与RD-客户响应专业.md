##1.2 MPLS三层VPN-VRF与RD-客户响应专业
###1.1.1 PE与CE设备之间的关系
* PE运行标准的路由协议 PE和CE通过EBGP、OSPF、RIP等动态路由协议和静态路由协议交换信息。
* PE建立和维护独立的公网和私网路由表（每个VPN实例的路由表）。
###1.1.2 MPLS如何解决路由重叠的问题。
* 当CEA和CEB两个不同站点使用同一个网段的时候，当他们到达对端相同路由的时候，对端PE需要区分这是两条路由，而不是一条。
* 在MPLS VPN中，不同VPN之间的路由隔离是通过VPN实例来实现的，也被叫做VRF(VPN Routing & Fowarding table )。 

![MPLS的路由](../image/1.png)
 
**VRF有什么用？**  
路由隔离和信息隔离来保证客户路由的安全。
MPLS L3 VPN的安全举措之一就是路由隔离和信息隔离，他是通过VPN路由转发表格MPLS中的LSP来实现的。  
**公网路由有什么用？**  
MPLS VPN是虚拟专用网，本身可以上公网，当然可以使用公网路由，而且CE和PE也要交流路由信息，因而需要公网路由。
****
###1.1.3 VPN实例的组成
为了保证VPN数据的独立性和安全性，PE上每个VPN实现都有独立的路由表和LFIB(label Forwarding Information Base 标签转发表)。  
VPN实例的组成：**标签转发表、IP路由表 与VPN实例绑定的接口以及VPN实例的管理信息，VPN实例的管理信息包括RD(Route Distinguisher， 路由标识符)，路由过滤策略和成员接口列表。**

###1.1.4 VPNv4地址与RD
VPNv4地址结构 : VPNv4 Address = RD + IPv4地址，这个地址具有唯一性。一方面可以支持PE将路由传递给对端，另外一方面可以区分唯一一个客户。
![RD格式](../image/2.png)  

* RD的格式：
  *  16位自治系统号ASN : 32位用户自定义数，例如∶100:1
   * 32位IP地址:16位用户自定义数。
* 例如∶172.1.1.1:1一般为一个site分配唯——个RD，它是VRF的标识符。

##1.3 MPLS三层VPN-RT-客户响应专业
### MPLS L3VPN使用BGP扩展属性（Route Target）
VPN Target 又被成为Route Target 路由目标来**控制VPN路由信息信息的发布**。

* PE路由器上的VPN有两类RT属性。

  *  Export Target 属性，本地PE路由器将从与自己直接相的CE学习到的VPN-IPv4路由发布到对端PE之前，为这些路由设置Export Target属性。    
  *  Import Target 属性， PE在接收到其他PE路由器发布的VPN-IPv4路由时，检查其Export Target属性，只有当此属性与VPN属性匹配的时候，才把路由加入到相应的VPN实例中。  
    
* 与RD类似 RT也有两种格式：
![RT的格式](../image/3.png)
