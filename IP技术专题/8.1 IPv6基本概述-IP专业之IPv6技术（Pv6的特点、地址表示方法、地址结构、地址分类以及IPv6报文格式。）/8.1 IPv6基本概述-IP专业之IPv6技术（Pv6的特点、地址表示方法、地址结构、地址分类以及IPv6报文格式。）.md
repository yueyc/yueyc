2021/2/16 14:48:04 
##8.1 IPv6基本概述-IP专业之IPv6技术（Pv6的特点、地址表示方法、地址结构、地址分类以及IPv6报文格式。）
###8.1.1 IPv6产生的背景

 IPv6是IPv4的未来替代协议。

 * IPv4协议时目前广泛部署的因特网协议，该协议简单，易于实现，互操作性好。但也存在很多问题
   * IPv4地址空间不足
   * 骨干路由器维护的路由表表项数量过大
   * 不易进行自动配置和重新编址
   * 不能解决日益突出的安全问题
 * IPv6具有以下优点：
   * 128地址结构，提供充足的地址空间
   *  层次化的网络结构，提高了路由效率
   *  IPv6报文头简洁。灵活，效率更高，好扩展。
   *  支持自动配置，即插即用。
   *  支持端到端安全。
   *  支持移动特性。
   *  新增流标签功能，更利用支持QoS。
###8.1.2 IPv6基本功能
 * IPv6基本功能包括IPv6邻居发现协议（邻居发现、路由器发现、无状态地址自动配置、重定向）
 * IPv6路径MTU发现以及IPv6域名解析。
 * 其中路由器发现和无状态地址自动配置是IPv6的新增功能，邻居发现功能类似于IPv4 ARP，但做了改进和增强。

###8.1.3 IPv6地址表示方法
####IPv6地址标识格式
 IPv6地址包括128比特，由使用由冒号分隔的16比特的十六进制数表示。16比特的十六进制数对大小写不敏感。如：**FEDC:BA98:7654:3210:FEDC:BA98:7654:3210**。
####表示方法
 * 首选格式_每组中的前导"0"都可以省略。
   * **2031:0:130F:0:0:9C0:876A:130B**
 * 压缩格式_地址中包含的连续两个或者多个组均为0的组， 可以用**"::"**代替。
   * **2031:0:130F:0:9C0:876A:130B**
 * 内嵌IPv4地址格式_内嵌的IPv4地址采用以前IPv4的十进制标识方法。
   *  **0:0:0:0:0:0:166.168.1.2/64**
###8.1.4 IPv6地址组成
 * IPv6地址由两部分组成：地址前缀和接口标识。   

   *  地址前缀 = IPv4中的网络号码部分
   *  接口标识 = IPv4中的主机号码
 * 地址前缀的标识方式为：IPv6地址/前缀长度（**ipv6-address/prefix-length**）。

###8.1.5 IPv6地址分类
 * 单播地址：用来唯一标识一个接口，类似于IPv4的单播地址，发送到单播地址的数据报文将被传送给此地址所标识的接口。
    * **全球单播地址**等价于IPv4公网地址，提供网络服务提供商（**ISP**），允许路由聚合，减少全球路由表项。
    * **链路本地地址**用于**邻居发现协议**和**无状态自动配置**中链路本地上节点之间的通信。
       * 使用链路本地地址作为源或者目的地址的数据报文不会被发送到其他链路上。
    * **站点本地地址**与IPv4中的私有地址类似。
       * 使用链路本地地址作为源或者目的地址的数据报文不会被转发到本站点外的其他站点。
    * **环会地址**：::1称为环回地址，不能分配给任何物理接口，用来给自己发送IPv6报文。
   * **未指定地址**：不分配给任何节点，在节点获得IPv6地址前，可以在源地址字段填入该地址，但是不能作为IPv6报文中的目的地址。
 * 组播地址：用来标识一组接口（**通常这组接口属于不同的节点**），类似于IPv4的组播地址。发送到组播地址的数据报文被传送给此地址所标识的所有接口。
 * 任播地址：用来标识一组接口（**通常这组接口属于不同的节点**）。发送到任播地址的数据报文被传送给此地址所标识的一组接口中距离源节点最近（**根据使用的路由协议进行度量**）的一个接口。
  * 注：IPv6中没有广播地址，广播地址的功能通过组播地址来实现。
  * 注：IPv6地址类型是由地址前面几位来指定的，主要地址类型与格式前缀的对应关系如表所示。
  
|地址类型|地址类型|格式前缀（二进制）|IPv6前缀标识|
|:-----:|:-----:|:---|
|**单播地址**|未指定地址|00...0(128bits)|::/128|
|**单播地址**|环回地址|00...1(128bits)|::1/128|
|**单播地址**|链路本地地址|1111111010|FE80::/10|
|**单播地址**|站点本地地址|1111111011|FEC0::/10|
|**单播地址**|全球单播地址|其他形式|-|
|**组播地址**|组播地址|11111111|FF00::/8|
|**任播地址**|任播地址|从单播地址空间中进行分配，使用单播地址的格式||



##8.2 IPv6协议介绍-IP专业之IPv6技术（要介绍ICMPv6、邻居发现、Path MTU、路由协议和组播协议。）
###8.2.1 IPv6邻居发现协议
* ICMP（Internet Control Message Protocol）Internet控制报文协议。 
   * 它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。
   * 控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。
 * IPv6邻居发现协议使用IPv6 ICMP消息和被请求节点的组播地址来得到同一网络（地址链路）上某个邻居的链路层地址。验证邻居的可达性，找到邻居路由器。每个IPv6节点都必须加入和其单播和泛播地址多播组。
 * IPv6邻居发现协议主要包括：**邻居发现、路由器发现、IPv6无状态地址自动配置、重定向功能。
###8.2.2 IPv6邻居发现协议消息类型及作用

![PWE3的工作过程](../image/1.png)
###8.2.3 IPv6单播路由技术
IPv6支持各种单播路由协议（IGP、EGP），IPv6单播路由协议实现和IPv4中类似，有些是在原有协议的基础上做了简单扩展（ISISv6、BGP4+），有些则是完全新的版本（RIPng、OSPFv3）。

* ISISv6
 * IS-IS通过新增TLV以实现对IPv6的支持
    * 236号TLV:定义路由信息前缀、度量值等信息来说明网络的可达性232号TLV。
    * 232号TLV：相当于IPv4中的“IP Interface Address”TLV，只不过把原来的32比特的IPv4地址改为128比特的IPv6地址。
* BGP4+
  * 对IPv6单播网络的支持特性称为BGP4+ 
  * MP-BGP引入了两个新的可选非过渡路径属性. 
      * MP_REACH_NLRI
      * MP_UNREACH_NLRI
* RIPng
 * 为了在IPv6网络中应用，RIPng对原有的RIP协议进行了修改：
     * UDP端口号，使用UDP的521端口发送和接收路由信息。
     * 组播地址：使用FF02::9作为链路本地范围内的RIPng路由器组播地址。
     * 路由前缀：使用128比特的IPv6地址作为路由前缀。
     * 下一跳地址：使用128比特的IPv6地址。
     *...
 * OSPFv3
  * 修改了LSA的种类和格式，使其支持发布IPv6路由
  * 修改部分协议流程，使其独立于网络协议，大大提高了可扩展性。
     * 主要包括用Router ID来标识邻居，使用链路本地地址来发现邻居等，使得拓扑本身独立于网络协议，便于未来拓展。
     * 进一步理顺了拓扑和路由的关系。OSPFv3在lSA中将拓扑和路由信息相分离，一二类LSA不再携带路由信息，而只是单纯的描述拓扑信息，另外用新增的八九类 lSA结合原来的三五七类LSA发布路由前缀信息。
     * 提高了协议适应性。通过引入LSA扩散范围的概念，进一步明确了对未知LSA的处理，使得协议可以在不识别LSA的情况下做出恰当处理。
##8.3 IPv6过渡技术-IP专业之IPv6技术（IPv6过渡技术概述、双栈技术、IPv6 over IPv4隧道和IPv4 over IPv6隧道）

##8.3.1 IPv4向IPv6过渡技术
 当前，大量的网络是IPv4网络，随着Ipv6的部署，很长一段时间是IPv4与Ipv6共存的过渡阶段。
过渡阶段所采用的过渡技术主要有：

 * 双栈技术：双栈节点与IPv4节点通讯时使用IPv4协议栈，与IPv6节点通讯时使用IPv6协议栈。
 * 隧道技术：提供了两个IPv6站点之间通过IPv4网络实现通讯连接以及两个IPv4站点通过IPv6网络实现通讯连接的技术。
 * IPv4/IPv6协议转换技术：提供了IPv4网络与IPv6网络之间的互访技术。
 * 隧道技术只要求隧道两端的设备支持两种协议，IPv6报文被封装在Ipv4报文中穿越IPv4网络，实现IPv6报文透明传输，反过来，IPv4报文被封装在IPv4网络中，实现IPv4报文的透明传输。
 
![PWE3的工作过程](../image/2.png)