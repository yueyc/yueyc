##1.1 VPN
###1.1.1 VPN基本概念
VPN就是虚拟专用网，互联网本质是一个开放的网络，没有任何安全性可言，而VPN就是实现用户安全通信的一种技术。
###1.1.2 VPN关键技术
使用VPN需要登录客户端，涉及到保密需要对数据进行加密，以及需要使用一种网络协议承载另外一种协议，因此涉及到主要技术有**隧道技术 加解密技术 密钥管理技术 身份认证技术**。  
**隧道技术就是利用网络中的基础设施进行网络通信的一种技术。隧道协议将其他协议的数据重新封装在新的包头中进行传送**，从而实现数据在网络上的传送。隧道协议可以实现在数据链路层、网络层和传输层。
###1.1.3 VPN解决方案
**内联网VPN(Intranet VPN)** 企业内部各个局域网之间的保密通信。  
**外联网VPN(Extranet VPN)** 企业和客户以及供应商之间的保密通信。
**接入层VPN(Access VPN)** 流动人员利用ISP提供的VPN服务和企业通信。
##1.2 第二层隧道协议
工作在数据链路层的隧道协议，常见的有PPTP（**tunnel：隧道**），L2TP(二层隧道协议)。

###1.2.1 PPTP的工作过程
**PAC**（PPTP Access Concentrator，PAC） 接入网集中器：负责接入客户端设备。  
**PNS**(PPTP Network Server,PNS) 网络服务器：接入服务器。  
![avatar](../image/1.png)
**PAC与PNS**之间具有两条通道，一条运行在TCP层的控制连接（**建立 管理 释放PPP隧道**），一条是传输数据单元的IP隧道。  
PPP分组必须经过**GRE**封装后才能在PAC-PNS隧道传送。  
**GRE** Generic Routing Encapsulation，一种网络层协议内部封装另外一层网络层协议，对数据加密处理。 VPN外设备无法探知其内容。

**负载数据在本地和远程都是IP明文传输，只有在VPN中进行了加密和封装**。

###1.1.2 第2层隧道协议
**L2TP** （Layer 2 Tunnling Protocal，L2TP）  
**L2TP Access Server**：LAS,l2tp接入服务器
**L2TP Network Server**: LNS, L2TP网络服务器
**Network Access Server**：NAS,网络接入服务器
![典型的L2TP接入模式](../image/2.png)

**用户用过传统电话网或者综合数字接入网（PSTN/ISDN）接入到l2tp接入服务器**  
**L2TP本身无加密措施，在Ip网中，需要借助UDP（传输层）协议加密，数据的压缩也同样如此**
**L2TP隧道中的数据承载在PPP协议中。**  

**图中展示的是L2TP中数据的封装过程。**
![典型的L2TP接入模式](../image/3.png)
##1.3 IPSec
###1.3.1 Ipsec的基本功能
**IPSec（IP Security）**是网络层协议（第三层）用于增强网络的安全性。其功能主要有**数据完整性、认证、保密性、应用透明的安全性**。
**应用透明的安全性**指的是安全性指的是IPSec具有认证和加密作用的头直接放在原来的IP头和上层协议（TCP)之间，因而，对原来的数据不需要进行处理即可从IP转向IPsec。
![图中展示的是在原来的IP头和TCP之间加入认证头](../image/4.png)
  
**图中展示的是在原来的IP头和TCP之间加入认证头**。
###1.3.2 IPSec的功能分类
**认证头**：提供数据完整性和数据源认证。
**封装安全负荷**：提供数据保密性和完整性，防止重放攻击。
**密钥交换协议**：用于生成和分发在ESP和AH中使用的密钥。也可进行安全认证。

###1.4 SSL
**安全套接层（Secure Socket Layer）**：传输层安全协议，用于实现Web安全通信。
SSL的基本目标是实现两个实体之间安全可靠的通信。SSL协议分为两层，底层是SSL记录协议，运行于TCP之上。
![图中展示的是SSL协议栈](../image/5.png)

**SSL协议栈**

##1.5 BGP 
###1.5.1 BGP中基本概念
**BGP(Border Gateway Protocal 边界网关协议)**    

* 不同自治域之间交换路由的协议。    
* 采用距离-向量路由协议。（**主要路由表项**）
* 寻找能够达到目的地的比较好的路由，而非最佳路由。（**采用多种策略进行路由选择**）  
  
**Peer**：相互交互报文的Speaker之间互称对等体（Peer）。
**Speaker**：发送BGP报文的设备称为BGP发言者，并发布给其他Speaker。  
**Route ID**：BGP设备的32位置值，在open报文中携带，具有唯一性。缺省情况下，本地lookback接口的IPV4地址作为路由器号。
**BGP的基本原理**    

* 每个自治域选择至少一个路由器发言人（Speker）。  
* 每一个发言人与其他自治域中发言人建立TCP连接。
* 在TCP连接上交换BGP报文以及建立BGP会话，交流路由信息，这样就可以找到各自的路由。
![图中展示的BGP](../image/6.png)
**BGP的特点**  
* Speaker的个数和自治系统数量相当，因此路由选择比较简单。
* 支持CIDR(Classless Inter-Domain Routing 无类别域间路由)。
* 主要路由表项：目的网络前缀、下一跳路由器以及到达该目的网络需要经过的各个自治系统序列。
**BGP的报文**
* 打开报文：建立对等体联系。
* 更新报文：发送路由以及撤销路由。
* 保活路由： 用来确认打开报文和周期性地确认对等体还活着。
* 通知报文：用来发送检测到的差错。

**——————————————————————————————————————————————————**

##1.6 MPLS L3 VPN 概述
